<html>
  <head>
    <title>Vue.js 애완용품샵</title>
    <meta charset="UTF-8" />
    <script src="https://unpkg.com/vue"></script>
    <link rel="stylesheet" type="text/css" href="/assets/css/app.css" />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
      crossorigin="anonymous"
    />
  </head>
  <body>
    <div id="app">
      <header>
        <div class="nav">
          <h1>{{ sitename }}</h1>
        </div>
        <div class="nav">
          <span>{{cartItemCount}}</span>
          <!-- 계산된 속성을 보여주는 데이터 바인딩 -->
        </div>

        <div class="nav">
          <button v-on:click="showCheckout">
            <span>{{ cartItemCount }}</span>
            <span>체크아웃</span>
          </button>
        </div>
      </header>
      <div>
        <figure>
          <img v-bind:src="product.image" />
        </figure>
        <h2>{{ product.title }}</h2>
        <p v-html="product.description"></p>
        <p class="price">
          {{ product.price | formatPrice }}
          <!-- 새로운 가격 값을 형식화하는 데 새로운 출력 필터를 사용합니다. -->
        </p>
        <button v-on:click="addToCart" v-if="canAddToCart">
          장바구니 담기
        </button>
        <button disabled="true" v-else>장바구니 담기</button>
      </div>
    </div>

    <script type="text/javascript">
      var APP_LOG_LIFECYCLE_EVENTS = true; // 콜백을 사용 또는 중지하는 데 사용되는 변수
      var webstore = new Vue({
        el: "#app",
        data: {
          showProduct: true, // 이 속성은 상품 페이지를 보여줄지 체크합니다.
          sitename: "Vue.js 애완용품샵",
          product: {
            id: 1001,
            title: "고양이 사료, 25파운드 (title)",
            description:
              "당신의 고양이를 위한 <em>거부할 수 없는</em> 유기농 25파운드 사료입니다.",
            price: 2000,
            image: "cat.png",
            availableInventory: 5, // 다른 상품 데이터 다음에 availableInventory 속성을 추가합니다.
          },
          cart: [], // 카트 아이템을 담은 배열을 표시
        },

        methods: {
          // 메서드 객체는 새 함수를 포함
          addToCart: function () {
            // addchart 함수를 정의
            this.cart.push(this.product.id);
          },
          showCheckout() {
            // showCheckout 메서드는 <장바구니 담기> 버튼을 누른 후 실행
            this.showProduct = this.showProduct ? false : true; // 참과 거짓을 전환하는 삼항 연산
            console.log("showCheckout methods");
          },
        },

        computed: {
          // 계산된 객체를 추가
          cartItemCount: function () {
            // 장바구니 배열에 있는 상품 개수를 반환
            return this.cart.length || "";
          },
          canAddToCart: function () {
            // canAddtoCart 계산된 속성을 사용
            return this.product.availableInventory > this.cartItemCount;
            // 이미 장바구니에 담겨있는 상품 개수를 availableInventory와 비교
          },
        },

        filters: {
          formatPrice: function (price) {
            if (!parseInt(price)) {
              return "";
            }
            if (price > 99999) {
              var priceString = (price / 100).toFixed(2);
              var priceArray = priceString.split("").reverse();
              var index = 3;
              while (priceArray.length > index + 3) {
                priceArray.splice(index + 3, 0, ",");
                index += 4;
              }
              return "$" + priceArray.reverse().join("");
            } else {
              return "$" + (price / 100).toFixed(2);
            }
          },
        },
        // 생명 주기 코드
        beforeCreate: function () {
          if (APP_LOG_LIFECYCLE_EVENTS) {
            console.log("beforeCreate");
          }
        },
        created: function () {
          if (APP_LOG_LIFECYCLE_EVENTS) {
            console.log("created");
          }
        },
        beforeMount: function () {
          if (APP_LOG_LIFECYCLE_EVENTS) {
            console.log("beforeMount");
          }
        },
        mounted: function () {
          if (APP_LOG_LIFECYCLE_EVENTS) {
            console.log("mounted");
          }
        },
        beforeUpdate: function () {
          if (APP_LOG_LIFECYCLE_EVENTS) {
            console.log("beforeUpdate");
          }
        },
        updated: function () {
          if (APP_LOG_LIFECYCLE_EVENTS) {
            console.log("updated");
          }
        },
        beforeDestroy: function () {
          if (APP_LOG_LIFECYCLE_EVENTS) {
            console.log("beforeDestroy ");
          }
        },
        destroyed: function () {
          if (APP_LOG_LIFECYCLE_EVENTS) {
            console.log("destroyed");
          }
        },
      });
    </script>
  </body>
</html>
